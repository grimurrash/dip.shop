(function (a) {
    config_js_login_form = {
        submitHandler: function (b) {
            let form = a('#logForm')[0];
            let formData = new FormData(form);
            a.ajax({
                type: "POST",
                dataType: "html",
                data: formData,
                url: '/login',
                processData: false,
                contentType: false,
                success: function (c) {
                    data = JSON.parse(c);
                    window.location.href = data.url;
                },
                error: function (error) {
                    error = JSON.parse(error.responseText);
                    let errors = error.errors;
                    let errors_keys = Object.keys(errors);
                    let errorsMessages = document.querySelectorAll('.help-block');
                    errorsMessages.forEach(el => el.remove());
                    let errorsControl = document.querySelectorAll('.form-group');
                    errorsControl.forEach(el => el.classList.remove('has-error'));

                    errors_keys.forEach((key) => {
                        error_message = errors[key][0];
                        a('.js_login_form input[name="' + key + '"').closest('.form-group').addClass('has-error');
                        if(key != 'personalData'){
                            $(`<span class="error help-block">${error_message}</span>`).insertAfter('.js_reg_form input[name="' + key + '"')
                        }else{
                            $(`<span class="error help-block">${error_message}</span>`).insertBefore('.js_reg_form input[name="' + key + '"')

                        }

                    })
                }
            })
        }, errorElement: "span", errorPlacement: function (b, c) {
            duble = c.next(".help-block");
            if (duble.size() > 0) {
                duble.remove()
            }
            b.addClass("help-block").insertAfter(c)
        }, showErrors: function (b, c) {
            a(this.currentElements).closest(".form-group").removeClass("has-error");
            if (c.length > 0) {
                for (k in c) {
                    a(c[k].element).closest(".form-group").addClass("has-error")
                }
            }
            this.defaultShowErrors(b, c)
        }, messages: {USER_LOGIN: {required: "Укажите Логин"}, USER_PASSWORD: {required: "Укажите Пароль"}}
    };
    logonPopoverConfig = {
        content: function () {
            return a("#login_reg_popup_content").html()
        }, title: function () {
            return a("#login_reg_popup_title").html()
        }, shown: function () {
            if (a(window).height() - a(".navbar-fixed-top").height() <= a(".logon .popover").height()) {
                a(".logon .popover").css({top: 0})
            }
            a(".logon .recovery").click(function () {
                var c = a(".logon #login #loginPassword"), b = c.is(":disabled");
                a("#alertBlockWrongPass").css("display", "none");
                a(".logon #login *[data-alternative]").each(function () {
                    var d = a(this).text();
                    a(this).text(a(this).data("alternative")).data("alternative", d)
                });
                if (b) {
                    c.attr("disabled", false).closest(".form-group").removeClass("hidden");
                    a('.logon input[name="TYPE"]').val("AUTH");
                    a('.logon button[type="submit"]').attr("name", "enter_sbmt")
                } else {
                    c.attr("disabled", true).closest(".form-group").addClass("hidden");
                    a('.logon input[name="TYPE"]').val("SEND_PWD");
                    a('.logon button[type="submit"]').attr("name", "send_account_info")
                }
            });
            $.validator.setDefaults({ ignore: ['.check'] });
            a(".js_login_form").submit(function (e) {
                e.preventDefault();
            }).validate(config_js_login_form);

            a(".js_reg_form").submit(function (e) {
                e.preventDefault();

            }).validate(config_js_reg_form);
        }
    }
})(jQuery);