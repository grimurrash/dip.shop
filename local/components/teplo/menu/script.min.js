(function (f) {
    var b = f(".hamburger"), i, c, g = false, d, h, a = 0, e = false;
    moveMenu = function (j) {
        if (j) {
            j.preventDefault();
            j.stopPropagation()
        }
        if (f("#menu").hasClass("noscroll")) {
            return
        }
        var n = is_mobile(), q = f(window).scrollTop(), n = is_mobile(), r = f(".menu .panel").height(),
            m = f(".wrap_content").height(), l = f(".wrap").get(0).offsetTop - f(".navbar-fixed-top").height(),
            s = (l + m - q) - r, p = (q > l && !n) ? "absolute" : "static",
            o = (q > l && s > 0 && !n) ? (q - l) + "px" : (m - r - 2) + "px", k = "inherit";
        f("#menu").closest(".panel").css("top", o).css("position", p).css("width", k)
    };
    toggleMenu = function (k, j) {
        if (d && j == "mouseleave") {
            d.parent().siblings().removeClass("open");
            d.parent().toggleClass("open")
        }
        if (h && j == "mouseenter") {
            h.parent().siblings().removeClass("open");
            h.parent().toggleClass("open")
        }
        g = !k
    };
    resizeMenu = function () {
        var n = f(".menu .panel-heading").outerHeight() - 5, m = f(".pz_menu > li").outerHeight(), l = 0,
            k = f(".pz_menu > li").size(), j = n + m * k + 9;
        f(".pz_menu > li").each(function (p, o) {
            if (!BX.browser.IsChrome() && p != 0 && p % ((p > 7) ? 3 : 2) == 0) {
                l++
            }
            _height = f(o).children("div").css("top", -(n + m * (p) + l) + "px").height();
            _height = (_height > j) ? _height : j;
            f(o).find(".info").css("min-height", _height + "px")
        });
        f(".pz_menu > li > div").css("min-height", j + "px")
    };
    menutriger = function (k) {
        var j = is_mobile();
        if (k) {
            k.stopPropagation();
            var m = (!j && !f(k.currentTarget).is(k.relatedTarget) && f(k.currentTarget).parent().has(k.relatedTarget).length == 0);
            var l = (!j && !f(k.currentTarget).is(k.relatedTarget) && f(k.currentTarget).closest("ul").has(k.relatedTarget).length == 0);
            if ((!j && k.type == "mouseenter" && !f(this).parent().hasClass("open")) || (!j && k.type == "mouseleave" && f(this).parent().hasClass("open") && m) || (j && k.type == "click" && f(this).hasClass("dropdown-toggle"))) {
                if (k.type == "mouseleave") {
                    clearTimeout(c);
                    d = f(this);
                    if (c == 0 || g || (!j && m)) {
                        c = setTimeout(toggleMenu, 100, g, k.type)
                    }
                }
                if (k.type == "mouseenter") {
                    clearTimeout(i);
                    h = f(this);
                    delay_time = (new Date().getTime() - a > 100) ? 100 : 500;
                    delay_time = (!f(this).parent().hasClass("open") && l && m) ? 500 : delay_time;
                    a = new Date().getTime();
                    if (i == 0 || !g || (!j && m)) {
                        i = setTimeout(toggleMenu, delay_time, g, k.type)
                    }
                }
                if (k.type == "click") {
                    f(this).parent().siblings().removeClass("open");
                    f(this).parent().toggleClass("open");
                    if (j) {
                        f(".menu").animate({scrollTop: (f(".pz_menu>li").index(f(this).closest(f(".pz_menu>li"))) * 46)}, 500)
                    }
                }
            }
            if (!j && k.type == "mouseleave" && !f(this).parent().hasClass("open") && l && m) {
                h = null;
                f(this).parent().siblings().removeClass("open")
            }
            if (!j && k.type == "mouseleave" && f(this).parent().hasClass("open") && !l) {
                d = null
            }
            if (!j && k.type == "mouseenter" && f(this).parent().hasClass("open")) {
                h = null
            }
        }
    };
    f(document).ready(function () {
        resizeMenu();
        f(".block-text > li > a").click(function () {
            if (is_mobile()) {
                f(".block-text > li > ul").hide();
                f(this).next("ul").show()
            }
        });
        if (f("#menu").hasClass("open")) {
            f(".menu").addClass("menu-backdrop");
            f(".catalog-filter").addClass("out");
            if (is_mobile()) {
                no_hide_menu = true;
                f(".pz_menu").dropdown("toggle")
            }
        }
    });
    f(window).on("load scroll resize redraw", moveMenu).trigger("scroll");
    f("ul.dropdown-menu [data-toggle=dropdown], div.dropdown-menu").on("click mouseleave mouseenter", menutriger);
    f("#menu").on("shown.bs.dropdown", function () {
        show_backdrop();
        resizeMenu();
        b.removeClass("is-closed");
        b.addClass("is-open");
        f(".navbar-collapse").collapse("hide");
        f(".catalog-filter").collapse("hide").addClass("out");
        no_hide_menu = false
    }).on("hidden.bs.dropdown", function () {
        hide_backdrop();
        b.removeClass("is-open");
        b.addClass("is-closed");
        if (!f("#menu").hasClass("open")) {
            f(".catalog-filter").removeClass("out")
        }
        no_hide_menu = false
    }).on("hide.bs.dropdown", function (j) {
        if ((no_hide_menu && (is_mobile() || !f(".hamburger").hasClass("noclose"))) || f(".pz_menu").has(j.relatedTarget).length === 1) {
            no_hide_menu = false;
            return true
        } else {
            no_hide_menu = false;
            return false
        }
    })
})(jQuery);