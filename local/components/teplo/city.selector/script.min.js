(function(a){cityChangePopoverConfig={_processing:false,renderCity:function(g){g=g||null;var c="";var i=a("#city_change").text().replace(/\s/g,"");var h=(g)?a(this).text():i[0].toLowerCase();for(var e in allCityLinks.key){if(!allCityLinks.key.hasOwnProperty(e)){continue}c+='<a href="#" class="'+((h.length>0&&h.toLowerCase()==allCityLinks.key[e].toLowerCase())?"active":"")+'">'+allCityLinks.key[e]+"</a>"}a(".city_change .nav").html(c).find("a").on("click",cityChangePopoverConfig.renderCity);c="";if(h.length>0){var b=525;var d=0;var f;for(var e in allCityLinks.city){if(!allCityLinks.city.hasOwnProperty(e)){continue}if(h.length==0||(h.length>0&&allCityLinks.city[e].text.toLowerCase().indexOf(h.toLowerCase())===0)){if(d>=b){break}d++;f=(allCityLinks.city[e].action!=undefined)?"//"+(allCityLinks.city[e].url?allCityLinks.city[e].url:baseHost)+window.location.pathname+"?CITY_SET="+allCityLinks.city[e].action:"//"+allCityLinks.city[e].url+"."+baseHost+window.location.pathname;c+="<li><a "+(allCityLinks.city[e].action?"":'onclick="return checkBeforeRedirect();" ')+'href="'+f+'" class="'+((i.length>0&&i.toLowerCase()==allCityLinks.city[e].text.toLowerCase())?"active":"")+'">'+allCityLinks.city[e].text+"</a></li>"}}}a(".city_change ul").html(c);return false},initInputCity:function(b){b=b||"body";if(!cityChangePopoverConfig._processing&&b.indexOf("undefined")==-1){cityChangePopoverConfig._processing=true;if(a(b).size()>0){if(b!="body"){a("#location_search_field").removeClass("hidden")}else{a("#location_search_field").addClass("hidden")}a(b).append(a("#location_search_field"))}cityChangePopoverConfig._processing=false}else{setTimeout(function(){cityChangePopoverConfig.initInputCity()},300)}},placement:function(c,b){a(c).css({width:((a("#city_change").data("geotarget"))?250:"100%"),position:((a(b).attr("id")=="city_change")?"fixed":"absolute")});return"bottom"},content:function(){if(a("#city_change").data("geotarget")){return'<div class="city"><div class="header">Ваш город '+a("#city_change").text()+'?</div><div class="row"><div class="col-xs-12"><button type="button" data-dismiss="popover" class="btn btn-primary continue">Да</button> <button type="button" data-dismiss="popover" class="btn btn-default change">Изменить город</button></div></div></div>'}else{return'<div class="city"><div class="header">Город, в котором Вы собираетесь получать товары:</div><div class="nav navbar-nav"></div><ul class="block-city"></ul><div class="input-group" id="top_city_holder_input"></div></div>'}},title:function(){return'<button type="button" class="close" data-dismiss="popover" aria-hidden="true">&times;</button>'},shown:function(b){if(!a("#city_change").data("geotarget")){cityChangePopoverConfig.renderCity()}if(a("#top_city_holder_input").size()>0){cityChangePopoverConfig.initInputCity("#"+a(b.currentTarget).attr("aria-describedby")+" #top_city_holder_input")}a(".city_change .popover .continue, .city_change .popover .change").on("click",function(c){a("#city_change").data("geotarget",false);if(a(this).hasClass("change")){window.setTimeout(function(){a("#city_change").popover("show")},300)}if(a(this).hasClass("continue")){a.ajax({type:"GET",url:"/ajax/cityAccept.php"})}})},hide:function(){cityChangePopoverConfig.initInputCity()}}})(jQuery);