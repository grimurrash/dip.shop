(function (a) {
    config_js_reg_form = {
        submitHandler: function (b) {
            let form = a('#regForm')[0];
            let formData = new FormData(form);
            a.ajax({
                type: "POST",
                dataType: "html",
                data: formData,
                url: '/register',
                processData: false,
                contentType: false,
                success: function (c) {
                    data = JSON.parse(c);
                    window.location.href = data.url;
                },
                error: function (error) {
                    error = JSON.parse(error.responseText);
                    let errors = error.errors;
                    let errors_keys = Object.keys(errors);
                    let errorsMessages = document.querySelectorAll('.help-block');
                    errorsMessages.forEach(el => el.remove());
                    let errorsControl = document.querySelectorAll('.form-group');
                    errorsControl.forEach(el => el.classList.remove('has-error'));

                    errors_keys.forEach((key) => {
                        error_message = errors[key][0];
                        a('.js_reg_form input[name="' + key + '"').closest('.form-group').addClass('has-error');
                        if(key != 'personalData'){
                            $(`<span class="error help-block">${error_message}</span>`).insertAfter('.js_reg_form input[name="' + key + '"')
                        }else{
                            $(`<span class="error help-block">${error_message}</span>`).insertBefore('.js_reg_form input[name="' + key + '"')

                        }

                    })
                }
            })
        },
        errorElement: "span",
        errorPlacement: function (b, c) {
            duble = c.next(".help-block");
            if (duble.size() > 0) {
                duble.remove()
            }
            b.addClass("help-block").insertAfter(c)
        },
        showErrors: function (c, d) {
            var b = a(this.currentElements).closest(".form-group");
            if (d.length == 0) {
                b.removeClass("has-error")
            } else {
                b.addClass("has-error")
            }
            this.defaultShowErrors()
        },
        rules: {"email": {email: true}},
        messages: {
            "name": {required: "Укажите ФИО"},
            "email": {required: "Укажите e-mail", email: "Укажите правильный e-mail"},
            "password": {required: "Укажите Пароль"},
            "personal_data": {required: "Вы должно согласится с соглашением"}
        }
    }
})(jQuery);