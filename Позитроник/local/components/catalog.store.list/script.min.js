var maps={};var pointTypes={point:"Пункт выдачи",shop:"Магазин"};function mapInit(e){var c=17;var b='<div class="map-point">';b+='<a href="#" class="name">$[properties.name]</a>';b+='[if properties.typeName]<div class="type">$[properties.typeName]</div>[endif]';b+='[if properties.description]<div class="description">$[properties.description]</div>[endif]';b+='[if properties.phone]<div class="phone">$[properties.phone]</div>[endif]';b+='[if properties.worktime]<div class="worktime">$[properties.worktime]</div>[endif]</div>';maps[e]=new ymaps.Map("map_"+e,{center:[60.753994,77.622093],zoom:c,controls:["zoomControl","searchControl","typeSelector","fullscreenControl","routeButtonControl","rulerControl"]},{searchControlProvider:"yandex#search"});maps[e].behaviors.disable("scrollZoom");var a={currentCity:new ymaps.GeoObjectCollection(),all:new ymaps.GeoObjectCollection()},f=ymaps.templateLayoutFactory.createClass(b,{build:function(){f.superclass.build.call(this)},clear:function(){f.superclass.clear.call(this)}});var d=(e==="all")?points:{mapId:points[e]};$.each(d,function(k,g){var h={balloonContentLayout:f};if(pointTypes.hasOwnProperty(g.type)){g.typeName=pointTypes[g.type];$.extend(h,{balloonContentLayout:f,iconLayout:"default#image",iconImageHref:templatePath+"/img/"+g.type+".png",iconImageSize:[41,47],iconImageOffset:[-16,-46]})}var j=new ymaps.Placemark(g.coords,g,h);if(g.thisCity||(e!=="all")){a.currentCity.add(j)}else{a.all.add(j)}});if(a.currentCity.getLength()>0){maps[e].geoObjects.add(a.currentCity);setTimeout(function(){maps[e].setBounds(maps[e].geoObjects.getBounds(),{checkZoomRange:true}).then(function(){if(maps[e].getZoom()>c){maps[e].setZoom(c)}})},500)}setTimeout(function(){maps[e].geoObjects.add(a.all)},1000);maps[e].geoObjects.events.add("click",function(h){var g=h.get("target")})}function makeMap(a){if(typeof points==="object"&&(jQuery.isEmptyObject(maps[a])||$("#map_"+a+" ymaps").length==0)&&$("#map_"+a).length){ymaps.ready(function(){mapInit(a)})}}$(function(){var a=location.href;var b=$("#city_search_field .dropdown-field").val();$(document).on("change","#city_search_field .dropdown-field",function(c){if(this.value!=""&&this.value!=b){b=this.value;$.get(a,{AJAX:"Y",CITY:this.value},function(e){var d=$(".basket_content").parent();$(d).html(e)})}})});function ImgShw(c,d,b,h){var a="no";var g=0,f=0;if(d>screen.width-10||b>screen.height-28){a="yes"}if(b<screen.height-28){g=Math.floor((screen.height-b)/2-14)}if(d<screen.width-10){f=Math.floor((screen.width-d)/2-5)}d=Math.min(d,screen.width-10);b=Math.min(b,screen.height-28);var e=window.open("","","scrollbars="+a+",resizable=yes,width="+d+",height="+b+",left="+f+",top="+g);e.document.write('<html><head><script type="text/javascript">function KeyPress(){	if(window.event.keyCode == 27) 		window.close();}<\/script><title></title></head><body topmargin="0" leftmargin="0" marginwidth="0" marginheight="0" onKeyPress="KeyPress()"><img src="'+c+'" border="0" alt="'+h+'" /></body></html>');e.document.close()};